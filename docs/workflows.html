<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor Care - Quy trình Hệ thống</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #475569;
            --bg-light: #f8fafc;
            --white: #ffffff;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --header-height: 70px;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-light);
            color: #1e293b;
            line-height: 1.6;
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            height: var(--header-height);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            box-sizing: border-box;
            z-index: 1000;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--secondary);
            font-weight: 500;
            transition: color 0.2s;
            cursor: pointer;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        /* Main Content */
        main {
            padding: calc(var(--header-height) + 2rem) 2rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Sections */
        section {
            background: var(--white);
            border-radius: 16px;
            padding: 2.5rem;
            margin-bottom: 3rem;
            box-shadow: var(--shadow);
            scroll-margin-top: calc(var(--header-height) + 2rem);
        }

        h1 {
            color: #0f172a;
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 3rem;
        }

        h2 {
            color: var(--primary);
            font-size: 1.8rem;
            margin-top: 0;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .description {
            margin-bottom: 2rem;
            font-size: 1.1rem;
            color: #64748b;
        }

        .steps {
            background: #f1f5f9;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .steps ul {
            margin: 0;
            padding-left: 1.5rem;
        }

        .steps li {
            margin-bottom: 0.5rem;
        }

        /* Mermaid Wrapper */
        .diagram-container {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            display: flex;
            justify-content: center;
        }

        footer {
            text-align: center;
            padding: 2rem;
            color: var(--secondary);
            margin-top: auto;
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            main {
                padding: calc(var(--header-height) + 1rem) 1rem 1rem;
            }
        }
    </style>
</head>

<body>
    <nav>
        <a href="#" class="logo">DoctorCare Workflows</a>
        <div class="nav-links">
            <a href="#auth">Xác thực</a>
            <a href="#booking">Đặt lịch</a>
            <a href="#admin">Quản lý</a>
        </div>
    </nav>

    <main>
        <h1>Quy trình Nghiệp vụ DoctorCare</h1>

        <!-- Authentication System -->
        <section id="auth">
            <h2>1. Hệ thống Xác thực (Authentication)</h2>
            <div class="description">
                Quy trình đăng ký, đăng nhập và khôi phục mật khẩu đảm bảo an toàn cho người dùng và bảo mật hệ thống.
            </div>

            <div class="steps">
                <strong>Các chức năng chính:</strong>
                <ul>
                    <li>Đăng ký tài khoản mới (Bệnh nhân)</li>
                    <li>Đăng nhập (Sử dụng JWT Token)</li>
                    <li>Quên mật khẩu (Gửi mật khẩu mới qua Email)</li>
                    <li>Đổi mật khẩu (Người dùng tự nhập)</li>
                </ul>
            </div>

            <div class="diagram-container">
                <pre class="mermaid">
flowchart TD
    Start((Bắt đầu)) --> Choose{Chọn chức năng}
    
    %% Đăng nhập
    Choose -->|Đăng nhập| LoginUI[Form Đăng nhập]
    LoginUI -->|Nhập Email/Pass| API_Login[API: POST /login]
    API_Login --> CheckDB{Kiểm tra User?}
    CheckDB -->|Không| ErrLogin[Báo lỗi: User not found]
    CheckDB -->|Có| VerifyPass{Mật khẩu đúng?}
    VerifyPass -->|Không| ErrPass[Báo lỗi: Invalid credentials]
    VerifyPass -->|Đúng| GenToken[Tạo JWT Token]
    GenToken --> EndLogin((Đăng nhập thành công))

    %% Đăng ký
    Choose -->|Đăng ký| RegUI[Form Đăng ký]
    RegUI -->|Nhập Info| API_Reg[API: POST /register]
    API_Reg --> CheckExist{Email tồn tại?}
    CheckExist -->|Có| ErrExist[Báo lỗi: Email used]
    CheckExist -->|Không| HashPass[Mã hóa Mật khẩu]
    HashPass --> SaveDB[(Lưu User vào DB)]
    SaveDB --> EndReg((Đăng ký thành công))

    %% Quên Pass
    Choose -->|Quên mật khẩu| ForgotUI[Form Quên Pass]
    ForgotUI -->|Nhập Email| API_Forgot[API: POST /forgot-password]
    API_Forgot --> GenPass[Sinh Pass ngẫu nhiên 8 ký tự]
    GenPass --> HashReset[Mã hóa & Lưu DB]
    HashReset --> EmailService[Gửi Email chứa Pass mới]
    EmailService --> EndForgot((Hoàn tất gửi Email))
                </pre>
            </div>
        </section>

        <!-- Booking System -->
        <section id="booking">
            <h2>2. Quy trình Đặt lịch Khám (Booking)</h2>
            <div class="description">
                Luồng nghiệp vụ cốt lõi, từ việc tìm kiếm bác sĩ đến khi hoàn tất đặt lịch và nhận thông báo.
            </div>

            <div class="steps">
                <strong>Các bước thực hiện:</strong>
                <ul>
                    <li>Người dùng xem thông tin và chọn bác sĩ.</li>
                    <li>Kiểm tra khung giờ trống (Real-time).</li>
                    <li>Điền thông tin bệnh nhân và xác nhận đặt lịch.</li>
                    <li>Hệ thống lưu trạng thái "Chờ xác nhận" (Pending).</li>
                    <li>Gửi email xác nhận tự động.</li>
                </ul>
            </div>

            <div class="diagram-container">
                <pre class="mermaid">
sequenceDiagram
    actor Patient as Bệnh nhân
    participant FE as Website
    participant API as Backend API
    participant DB as Database
    participant Email as Email Service
    
    Patient->>FE: Xem chi tiết Bác sĩ
    FE->>API: GET /available?doctor_id=...
    API->>DB: Query lịch đã đặt
    DB-->>API: Danh sách giờ bận
    API-->>FE: Trả về các khung giờ
    
    Patient->>FE: Chọn giờ & Điền thông tin
    Patient->>FE: Nhấn "Đặt lịch miễn phí"
    FE->>API: POST /appointments
    
    Note over API: Validate dữ liệu đầu vào
    
    API->>DB: INSERT appointment (status: pending)
    DB-->>API: Success
    
    API->>DB: Lấy thông tin Bác sĩ
    DB-->>API: Doctor Info
    
    API->>Email: Gửi Email xác nhận đặt lịch
    Email-->>Patient: Email "Xác nhận thành công"
    
    API-->>FE: Trả về: Đặt lịch thành công
    FE-->>Patient: Hiển thị thông báo
                </pre>
            </div>
        </section>

        <!-- Management & Review -->
        <section id="admin">
            <h2>3. Quản lý & Đánh giá (Management)</h2>
            <div class="description">
                Quy trình hủy lịch và đánh giá chất lượng dịch vụ sau khi khám.
            </div>

            <div class="diagram-container">
                <pre class="mermaid">
flowchart LR
    subgraph Cancellation [Hủy Lịch]
        UE[Người dùng/Bác sĩ] -->|Yêu cầu hủy| APICancel[API: PUT /:id/cancel]
        APICancel --> CheckStatus{Status == Pending?}
        CheckStatus -->|No| ErrCancel[Báo lỗi]
        CheckStatus -->|Yes| UpdateCancel[DB: status = cancelled]
        UpdateCancel --> DoneCancel((Đã Hủy))
    end

    subgraph Rating [Đánh giá]
        Patient[Bệnh nhân] -->|Đánh giá 1-5 sao| APIRate[API: PUT /:id/rating]
        APIRate --> UpdateAppt[Update Appointment Rating]
        UpdateAppt --> CalAvg[Tính lại Rating TB Bác sĩ]
        CalAvg --> UpdateDoc[Update Doctor Profile]
        UpdateDoc --> DoneRate((Hoàn tất))
    end
                </pre>
            </div>
        </section>

        <footer>
            <p>&copy; 2024 Kevin. Đồ án Hệ thống DoctorCare.</p>
        </footer>
    </main>
</body>

</html>